# H5 Sequence Player - 项目完整介绍

## 1. 项目概述
这是一个基于 HTML5 Canvas 的交互式序列帧播放器（Sequence Player）。项目采用现代化的 Web 技术栈（Vanilla JS + CSS3），实现了高性能的图片序列播放、物理惯性拖拽、自动播放以及动态视觉效果（如黑客帝国代码雨加载特效）。

界面设计采用了 **macOS 窗口风格**，配合 3:4 的展示比例，营造出精致的桌面应用体验。项目旨在展示不同风格（如毛毡、水晶）和主题（如冰雪女孩、柴犬）的 3D 旋转展示效果。

## 2. 核心功能

### 2.1 交互式动画
*   **物理惯性拖拽**：用户可以通过触摸或鼠标拖拽 Canvas 区域来旋转模型。系统内置了物理引擎，模拟了阻尼（Friction）和惯性（Momentum），使旋转体验流畅自然。
*   **自动播放**：在无操作时，模型会自动旋转展示。
*   **控制按钮**：提供“左旋”、“右旋”和“回正”按钮，方便用户精确控制。

### 2.2 多风格与版本管理
*   **配置化驱动**：所有风格、关键词和描述文案均通过 `config.json` 动态加载。
*   **样式切换**：支持“毛毡”和“水晶”两种材质风格。
*   **版本轮播 (Variants)**：系统利用 `localStorage` 记录查看次数，自动在 v1、v2、v3 三个版本间轮播，展示不同的 Prompt 和画面细节。

### 2.3 视觉特效
*   **Matrix Rain (代码雨)**：在资源加载或等待指令期间，Canvas 上会展示黑客帝国风格的绿色代码雨动画，提升科技感。
*   **打字机效果**：右侧信息面板显示当前生成的 Prompt 提示词时，采用逐字打印的打字机特效。
*   **macOS 窗口 UI**：包含标志性的红黄绿红绿灯窗口控制按钮和磨砂玻璃（Backdrop Filter）效果。

### 2.4 调试与扩展
*   **Debug 面板**：内置可折叠的调试面板（Mock 调试），允许开发者手动模拟 Style 和 Word 的切换，以及触发外部指令模拟。
*   **外部指令响应**：支持通过 `window.postMessage` 接收外部控制指令（`py_btc_ai2_3_3`），实现与其他系统的联动。

## 3. 目录结构说明

```
/Users/chenxinguang/Downloads/h5-demo/
├── index.html          # 项目入口文件，定义 DOM 结构和 UI 布局
├── script.js           # 核心逻辑 (动画循环、物理引擎、资源加载、事件处理)
├── style.css           # 全局样式，包含 CSS 动画和响应式布局 (vmin)
├── config.json         # 配置文件，定义风格、词语和具体的 Prompt 描述
├── assets/             # 静态资源目录
│   ├── sequences/      # 序列帧图片目录 (按 style/word/version/frame 组织)
│   ├── frames/         # (可能用于存放其他帧资源)
│   ├── starry_bg.png   # 背景图
│   ├── exclude.png     # 遮罩图
│   └── ...
└── (v2 files)          # 包含 index-v2.html 等历史或备用版本
```

## 4. 技术实现细节

### 4.1 渲染引擎 (Rendering)
*   使用 `requestAnimationFrame` 实现高性能的渲染循环。
*   **Canvas API**：核心展示区使用 2D Canvas 绘制，相比 DOM 节点操作图片，性能更优且无卡顿。
*   **优化策略**：仅在资源加载完成后渲染；支持 PNG/JPG/WebP 格式自动降级（Fallback）。

### 4.2 物理系统 (Physics)
*   **状态管理**：`state` 对象维护当前帧 (`currentFrame`)、速度 (`velocity`)、方向 (`direction`) 等。
*   **惯性算法**：拖拽结束时保留速度，并在每一帧乘以摩擦系数 (`FRICTION = 0.9`) 直至停止，实现平滑减速。

### 4.3 资源加载 (Asset Loading)
*   **预加载**：一次性预加载 24 帧序列图，确保播放流畅。
*   **容错机制**：如果 PNG 加载失败，自动尝试加载 JPG，再失败尝试 WebP，最后使用 SVG 占位图。
*   **加载动画**：在图片加载过程中显示 Loading 遮罩和 Matrix Rain 特效，最少展示 3 秒，保证视觉体验的连贯性。

## 5. 配置说明 (config.json)

配置文件结构如下：

```json
{
    "version": "1.0",
    "styles": {
        "Style1": { "name": "毛毡", "description": "..." },
        "Style2": { "name": "水晶", "description": "..." }
    },
    "words": {
        "Word1": { "name": "奇妙的冰雪女孩" },
        "Word2": { "name": "柴犬一生爱自由" }
    },
    "sequences": {
        "Style1": {
            "Word1": {
                "v1": { "prompt": "..." },
                "v2": { "prompt": "..." }
            }
        }
    }
}
```

## 6. 使用与调试

1.  **打开项目**：直接在浏览器中打开 `index.html` (需通过本地服务器，因为使用了 fetch 加载 json)。
2.  **交互操作**：
    *   **拖拽**：在中央画面区域左右拖拽。
    *   **按钮**：点击底部按钮控制旋转。
3.  **调试模式**：
    *   URL 参数：访问 `index.html?debug=true` 可强制开启调试面板。
    *   面板功能：切换词语/风格，模拟接收指令，开关代码雨特效。

## 7. 浏览器兼容性
*   **Chrome 59+**：完全支持。
*   **移动端**：支持 Touch 事件，响应式布局适配手机和平板。
*   **特效降级**：对于不支持 `backdrop-filter` 的浏览器，按钮和面板会使用纯色背景回退方案。
